name: Deploy to HF Space

on:
  push:
    branches: [main]
    paths-ignore:
      - '**.md'
      - 'docs/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Push to HF Space
        run: |
          pip install -U huggingface_hub
          huggingface-cli upload nice-bill/agent-arena . --repo-type space --token=${{ secrets.HF_TOKEN }} --commit-message="deploy from github"

      - name: Wait for HF to process
        run: sleep 10

      - name: Restart HF Space
        run: |
          curl -X POST "https://nice-bill-agent-arena.hf.space/api/restart" \
            -H "Content-Type: application/json"

      - name: Verify new version
        run: |
          sleep 5
          curl -s "https://nice-bill-agent-arena.hf.space/api/version"
